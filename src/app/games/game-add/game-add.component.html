<md-toolbar>
    <app-back-button
        #backButton
        [disabled]="isPosting"
    ></app-back-button>
    <app-title [value]="'Create a game'"></app-title>
    <div class="toolbar-icon-spacer"></div>
</md-toolbar>

<form [formGroup]="form" (ngSubmit)="onSubmit()">
    <div formGroupName="location">
        <md-input-container [dividerColor]="
                    locationControls.name.valid ||
                    locationControls.name.pristine ?
                    'primary' : 'warn'" #locationNameContainer>
            <input mdInput
                #locationName
                formControlName="name"
                placeholder="Game location"
                required
                (click)="openLocationsPopup($event)"
                type='text'>
            <md-hint align="end" *ngIf="locationNameContainer._mdInputChild.focused">
                <span *ngIf="locationControls.name.errors?.required">
                    required
                </span>
                <span *ngIf="!locationControls.name.errors?.required">
                    {{ locationName.value.length }} / 30
                </span>
            </md-hint>
        </md-input-container>

        <md-card class="locations-list" [class.show]="showLocationsList">
            <md-list>
                <md-list-item
                    *ngFor="
                        let location of locations
                        | textSearch:locationName.value
                        | slice:0:5
                    "
                    (click)="setLocation($event, location)">
                    <h3 md-line>{{ location.name }}</h3>
                    <p md-line>{{ location.address }}</p>
                </md-list-item>
            </md-list>
        </md-card>
        <md-input-container [dividerColor]="
                    locationControls.address.valid ||
                    locationControls.address.pristine ?
                    'primary' : 'warn'" #locationAddressContainer>
            <input mdInput
                #locationAddress
                [style.width]="'100%'"
                autocomplete="off"
                formControlName="address"
                placeholder="Address"
                type='text'>
            <md-hint align="end" *ngIf="locationAddressContainer._mdInputChild.focused">
                <span *ngIf="locationControls.address.errors?.required">
                    required
                </span>
                <span *ngIf="!locationControls.address.errors?.required">
                    {{ locationAddress.value.length }} / 255
                </span>
            </md-hint>
        </md-input-container>
    </div>

    <div formGroupName="teams">
        <md-input-container [dividerColor]="
                    form.controls.teams.controls.teamName.valid ||
                    form.controls.teams.controls.teamName.pristine ?
                    'primary' : 'warn'" #teamNameContainer>
            <input mdInput
                   #teamName
                   formControlName="teamName"
                   placeholder="Select team"
                   required
                   type='text'>
            <md-hint align="end" *ngIf="teamNameContainer._mdInputChild.focused">
                <span *ngIf="form.controls.teams.controls.teamName.errors?.required">
                    required
                </span>
                <span *ngIf="!form.controls.teams.controls.teamName.errors?.required">
                    {{ teamName.value.length }} / 30
                </span>
            </md-hint>
        </md-input-container>
    </div>

    <br/>

    <div formArrayName="dates">
        <md-card *ngFor="let date of form.controls.dates.controls; let i=index">
            <md-card-content [formGroupName]="i">
                <div class="date-container">
                    <md-card-title>Date {{i + 1}}</md-card-title>
                    <md-input-container
                        class="full-width"
                        [dividerColor]="
                        form.controls.dates.controls[i].controls.date.valid ||
                        form.controls.dates.controls[i].controls.date.pristine ?
                        'primary' : 'warn'" #dateContainer>
                        <input #date
                            mdInput
                            formControlName="date"
                            placeholder="Game date"
                            required
                            type='date'>
                        <md-hint align="end" *ngIf="dateContainer._mdInputChild.focused">
                            <span *ngIf="form.controls.dates.controls[i].controls.date.errors?.required">
                                required
                            </span>
                        </md-hint>
                    </md-input-container>
                </div>
                <md-input-container class="full-width" #timeContainer>
                    <input #time
                        mdInput
                        formControlName="time"
                        [placeholder]="'Game time (' + tzName + ')'"
                        required
                        type='time'>
                    <md-hint align="end" *ngIf="timeContainer._mdInputChild.focused">
                        <span *ngIf="form.controls.dates.controls[i].controls.time.errors?.required">
                            required
                        </span>
                    </md-hint>
                </md-input-container>
            </md-card-content>
            <md-card-actions>
                <button md-button type="button" (click)="removeDate(i)" *ngIf="form.controls.dates.controls.length > 1">
                    Remove
                </button>
                <button md-button type="button" (click)="addDate()">
                    Add more
                </button>
            </md-card-actions>
        </md-card>
    </div>

    <br/>

    <div class="buttons">
        <button
            (click)="backButton.back()"
            [disabled]="isPosting"
            md-raised-button
        >
            Cancel
        </button>
            <!-- [disabled]="form.invalid || isPosting" -->
        <button
            color="primary"
            md-raised-button
            type="submit"
        >
            Save
        </button>
    </div>
</form>
